---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { quotes, getQuotesByAuthor } from '../../../scripts/data-loader.js';
import { generatePageTitle, generateMetaDescription } from '../../../scripts/utils.js';

// Generate paths for all quotes
export async function getStaticPaths() {
  return quotes.map(quote => ({
    params: {
      author: quote.authorSlug,
      slug: quote.slug
    },
    props: { quote }
  }));
}

const { quote } = Astro.props;

// Get related quotes by same author
const relatedQuotes = getQuotesByAuthor(quote.author)
  .filter(q => q.id !== quote.id)
  .slice(0, 3);

// Generate SEO metadata
const title = generatePageTitle(quote.quote, quote.author);
const description = generateMetaDescription(quote.quote, quote.author, quote.topic);

// Schema.org structured data for SEO
const schemaData = {
  "@context": "https://schema.org",
  "@type": "Quotation",
  "text": quote.quote,
  "author": {
    "@type": "Person",
    "name": quote.author
  },
  "about": quote.topic,
  "inLanguage": "en",
  "datePublished": quote.date,
  "publisher": {
    "@type": "Organization",
    "name": "Success Quotes",
    "url": "https://www.successquotes.co"
  }
};

// Social sharing URLs
const currentURL = `https://www.successquotes.co/quote/${quote.authorSlug}/${quote.slug}`;
const encodedURL = encodeURIComponent(currentURL);
const encodedText = encodeURIComponent(`"${quote.quote}" - ${quote.author}`);
const twitterShareURL = `https://twitter.com/intent/tweet?text=${encodedText}&url=${encodedURL}`;
const facebookShareURL = `https://www.facebook.com/sharer/sharer.php?u=${encodedURL}`;
const linkedinShareURL = `https://www.linkedin.com/sharing/share-offsite/?url=${encodedURL}`;
---

<BaseLayout 
  title={title}
  description={description}
  quote={quote.quote}
  author={quote.author}
  topic={quote.topic}
  canonicalURL={currentURL}
  schemaData={schemaData}
>
  <div class="quote-container">
    <!-- Main Quote -->
    <blockquote class="quote-text">
      "{quote.quote}"
    </blockquote>
    
    <p class="quote-author">â€” {quote.author}</p>
    
    <!-- Meta Tags -->
    <div class="quote-meta">
      {quote.topic && (
        <a href={`/topic/${quote.topicSlug}`} class="quote-tag">
          {quote.topic}
        </a>
      )}
      {quote.category && (
        <a href={`/category/${quote.categorySlug}`} class="quote-tag">
          {quote.category}
        </a>
      )}
      <a href={`/author/${quote.authorSlug}`} class="quote-tag">
        More by {quote.author}
      </a>
    </div>
    
    <!-- Share Buttons -->
    <div class="share-buttons">
      <a href={twitterShareURL} target="_blank" rel="noopener noreferrer" class="share-btn" title="Share on Twitter">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z"/>
        </svg>
      </a>
      <a href={facebookShareURL} target="_blank" rel="noopener noreferrer" class="share-btn" title="Share on Facebook">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/>
        </svg>
      </a>
      <a href={linkedinShareURL} target="_blank" rel="noopener noreferrer" class="share-btn" title="Share on LinkedIn">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6zM2 9h4v12H2z"/>
          <circle cx="4" cy="4" r="2"/>
        </svg>
      </a>
      <button class="share-btn" title="Copy link" onclick="copyToClipboard()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/>
          <path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/>
        </svg>
      </button>
    </div>
    
    <!-- Action Buttons -->
    <div class="quote-actions">
      <a href="/random" class="btn btn-primary">Get Random Quote</a>
      <a href="/quotes" class="btn btn-secondary">Search All Quotes</a>
    </div>
    
    <!-- Related Quotes -->
    {relatedQuotes.length > 0 && (
      <div class="related-quotes">
        <h2 class="section-title">More quotes by {quote.author}</h2>
        <div style="display: grid; gap: 20px; margin-top: 30px;">
          {relatedQuotes.map(related => (
            <a 
              href={`/quote/${related.authorSlug}/${related.slug}`}
              style="text-decoration: none; padding: 20px; background: rgba(255, 255, 255, 0.05); border-radius: 12px; transition: all 0.3s;"
            >
              <blockquote style="color: #ccc; font-style: italic; margin-bottom: 10px;">
                "{related.quote}"
              </blockquote>
              {related.topic && (
                <span style="font-size: 0.9em; color: #888;">
                  Topic: {related.topic}
                </span>
              )}
            </a>
          ))}
        </div>
      </div>
    )}
    
    <!-- Call to Action -->
    <div style="text-align: center; margin-top: 60px; padding: 40px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px;">
      <h3 style="font-size: 1.8em; color: white; margin-bottom: 15px;">
        Get daily inspiration in your pocket
      </h3>
      <p style="color: rgba(255, 255, 255, 0.9); margin-bottom: 25px;">
        Thousands of curated success quotes from the world's most successful people
      </p>
      <a 
        href="https://apps.apple.com/gb/app/success-quotes/id6752120038?itscg=30200&itsct=apps_box_link&mttnsubad=6752120038"
        class="btn btn-primary"
        style="background: white; color: #667eea;"
      >
        Download Success Quotes App
      </a>
    </div>
  </div>
  
  <script>
    function copyToClipboard() {
      const url = window.location.href;
      navigator.clipboard.writeText(url).then(() => {
        alert('Link copied to clipboard!');
      }).catch(err => {
        console.error('Failed to copy:', err);
      });
    }
  </script>
</BaseLayout>


